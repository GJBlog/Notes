## 详解YUV

### 简介

YUV：是一种颜色编码方法，跟RGB是同一个级别的概念，广泛用于多媒体领域中

换句话说，图像中每一个像素的颜色信息，除了可以用RGB的方式表示，也可以使用YUV的方式表示

### 对比RGB

#### 体积更小

- 如果使用RGB
  - 比如RGB888（R、G、B每个分量都是8bit）
  - 1个像素占用24bit（3字节）
- 如果使用YUV
  - 1个像素可以减小至平均只占用12bit（1.5字节）
  - 体积为RGB888的一半

#### 组成

RGB数据是由R、G、B三个分量组成

YUV数据是由Y、U、V三个分量组成，现在通常说的YUV指的是YCbCr

* Y：表示亮度（Luminance、Luma），占8个字节
* Cb、Cr：表示灰度，(Chrominance、Chroma)
  * Cb：蓝色色度分量，占8bit(1字节)
  * Cr：红色色度分量，占8bit(1字节)

### 转换

#### 公式1

- RGB的取值范围是[0,255]
- Y的取值范围是[16,235]
- UV的取值范围是[16,239]

```
Y = 0.257R + 0.504G + 0.098B + 16
U = -0.148R - 0.291G + 0.439B + 128
V = 0.439R - 0.368G - 0.071B + 128 

R = 1.164(Y - 16) + 2.018(U - 128)
G = 1.164(Y - 16) - 0.813(V - 128) - 0.391(U - 128)
B = 1.164(Y - 16) + 1.596(V - 128)
```

#### 公式2

- RGB的取值范围是[0, 1]
- Y的取值范围是[0, 1]
- UV的取值范围是[-0.5, 0.5]

```
Y = 0.299R + 0.587G + 0.114B
U = 0.564(B - Y) = -0.169R - 0.331G + 0.500B
V = 0.713(R - Y) = 0.500R - 0.419G - 0.081B
 
R = Y + 1.403V
G = Y - 0.344U - 0.714V
B = Y + 1.770U
```

#### 公式3

- RGB的取值范围是[0, 255]
- YUV的取值范围是[0, 255]

```
Y = 0.299R + 0.587G + 0.114B
U = -0.169R - 0.331G + 0.500B + 128
V = 0.500R - 0.419G - 0.081B + 128
 
R = Y + 1.403(V - 128)
G = Y - 0.343(U - 128) - 0.714(V - 128)
B = Y + 1.770(U - 128)
```

### 色度二次采样

#### 原理

> 人眼的视网膜上，分布着两种感光细胞：视杆细胞、视锥细胞

![视网膜](https://img2020.cnblogs.com/blog/497279/202104/497279-20210426155047283-1582687227.png)

- 视杆细胞
  - 感知光线的强弱
  - 没有色彩识别功能
  - 负责夜间非彩色视觉

- 视锥细胞
  - 感知颜色
  - 负责白天彩色视觉
  - 如果你的视锥细胞发育不正常，数量太少，那感知颜色就会受阻，可能会导致你色弱

![图片](https://img2020.cnblogs.com/blog/497279/202104/497279-20210426155049335-298714345.png)

人眼中有上亿个感光细胞，其中视杆细胞占了95%，而视锥细胞仅占5%。

因此，人眼对亮度的敏感程度要高于对色度的敏感程度，人眼对于亮度的分辨要比对颜色的分辨精细一些。

如果把图像的色度分量减少一些，人眼也丝毫感觉不到变化和差异。

#### 概念

如果在色度分量进行(相对亮度分量)较低分辨率的采样，也就是存储较多的亮度细节，较少的色度细节，这样就可以在不明显降低画面质量的同时缩小图像的体积，上述被称为色度二次采样(Chroma Subsampling)

#### 采样格式

采样格式通常用A:B:C的形式来表示，比如4:4:4、4:2:2、4:2:0等，其中我们最需要关注的是4:2:0。

- A：一块A*2个像素的概念区域，一般都是4
- B：第1行的色度采样数目
- C：第2行的色度采样数目
  - C的值一般要么等于B，要么等于0

![image-20220604175300667](/Users/guojie/Notes/音视频/images/YUV_采样格式.png)

![image-20220604175407477](/Users/guojie/Notes/音视频/images/YUV_采样格式_02.png)

上图中，不管是哪种采样格式，Y分量都是全水平、全垂直分辨率采样的，每一个像素都有自己独立的Y分量。



### 存储格式

存储格式，决定了YUV数据是如何排列和存储的

#### 分类

YUV的存储格式可以分为3大类：

* Planar(平面)
  * Y、U、V分量分开单独存储
  * 名称通常以字母p结尾
* Semi-Planar(半平面)
  * Y分量单独存储，U、V分量交错存储
  * 名称通常以字母sp结尾
* Packed(紧凑)
  * 或者叫Interleaved （交错）
  * Y、U、V分量交错存储

#### 4.4.4



#### 4.2.2

#### 4.4.0



### 格式转换

### 显示YUV



