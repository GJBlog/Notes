## 网络层

* 网络层数据包(IP数据包，Packet)，由首部 + 数据两部分组成
* 数据：很多时候是由传输层传递下来的数据段(Segment)

![image-20220703143303836](/Users/guojie/Notes/网络/学习网络课程笔记/images/网络层_首部.png)

#### 首部

* 版本(Version)

  * 4位
  * 0b0100：IPv4
  * 0b0110：IPv6

* 首部长度(Header Length)

  * 占4位，二进制乘以4才是最终的长度
  * 0b0101：20 (最小值)
  * 0b1111：60 (最大值)

* 区分服务(Differentiated Services Field)

  * 占8位
  * 可以用于提高网络的服务质量(Qos， Quality Of Service)

* 总长度（Total Length）

  * 占16位
  * 首部 + 数据的长度之和，最大值是65535
  * 由于帧的数据不能超过1500字节，所以过大的IP数据包，需要分成片(Fragments)传输给数据链路层
  * 每一片都有自己的网络层首部(IP首部)

  ![image-20220703150006377](/Users/guojie/Notes/网络/学习网络课程笔记/images/网路层_首部_最长度.png)

* 标识、标志

  * 标识(Identification)
  * 占16位
  * 数据包的ID，当数据包过大进行分片时，同一个数据包的所有片的标识都是一样的
  * 有一个计数器专门管理数据包的ID，每发出一个数据包，ID就加1

* 片偏移

  * 占13位
  * 片偏移乘以8：字节偏移
  * 每一片的长度一定是8的整数倍

  ![image-20220703180721856]( /Users/guojie/Notes/网络/学习网络课程笔记/images/网络层_首部_片偏移.png)

* 生存时间

  * 占8位
  * 每个路由器在转发之前会将TTL减1，一旦发现TTL减为0，路由器会返回错误报告
  * 观察使用ping命令后的TTL，能够推测出对方的操作系统、中间经过了多少个路由器

  ![image-20220703180252746](/Users/guojie/Notes/网络/学习网络课程笔记/images/网路层_首部_生存时间.png)

* 协议

  * 占8位
  * 表明所封装的数据是使用了什么协议

  ![image-20220703180046422](/Users/guojie/Notes/网络/学习网络课程笔记/images/网络层_首部_协议.png)

* 首部校验和(Header Checksum)

  * 用于检查首部是否有错误