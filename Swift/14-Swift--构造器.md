# 构造器(Initialization)

### 构造器

1、特点：

* 跟OC的构造方法相比，Swift的构造方法没有返回值(除了可失败构造器return nil除外)
* 目的是设置实例中每个存储型属性的初始值和必要的初始化工作
* 在为存储型属性设置默认值或者在构造器中为其赋值，不会触发属性的观察器

2、形式

* 以关键字init命名

```swift
init(paramater) {
   // 
}
```

3、内部外部参数

* 默认下，Swift会为构造器的每个参数自动生成一个跟内部名字相同的外部名
* 可以通过 _ 将外部参数名省略

```swift
init(_ celsius: Double) {
    //
}
```

4、常量属性

* 可以在构造的过程结束前设置常量属性的值，一旦被赋值，它将永远不可更改
* 对于类而言，常量属性只能在定义它的类的构造过程中修改，不能在子类中修改

5、默认构造器(Default Initializers)

* 当结构体、类的所有属性都有默认值，同时没有自定义构造器，Swift会自动为类、结构体提供一个默认构造器，默认构造器会简单创建一个所有属性都是设置为默认值的实例
* 特别的，对于结构体而言，如果本身没有提供自定义构造器，还会自动获得一个逐一成员构造器，即使结构体中存储型属性没有默认值

```swift
struct Size {
    var width = 0.0, height = 0.0
}
let twoByTwo = Size(width: 2.0, height: 2.0)
```

6、值类型构造器代理(Initializer Delegation for Value Types)

* 构造器通过调用其他构造器来完成实例的部分构造过程，被称为构造器代理。
* 在值类型中，你可以使用self.init在自定义的构造器中引用相同类型的其他构造器，当然，只能在构造器内调用self.init
* 一旦为值类型自定义了一个自定义的构造器，则无法访问到默认构造器(如果是结构体，还则无法访问到逐一成员构造器)

7、类构造器

* 类中的所有存储型属性包括所有继承自父类的属性都必须在构造过程中完成设置初始值
* 分类：
    * 指定构造器(最主要)，通常一个类有一个指定构造器
    
    ```swift
    init(paramaters) {
        
    }
    ```
    
    * 便利构造器
    
    ```swift
    convenivence init(paramaters) {
        
    }
    ```
8、类构造器调用(代理)规则

* 指定构造器必须调用其直接父类的指定构造器
* 便利构造器必须调用同类中定义的其他构造器(默构造器、指定构造器、便利构造器)
* 便利构造器最后必须要调用指定构造器

简称：指定构造器总是向上代理，便利构造器总是横向代理

9、类的构造过程中编译器检查

* 指定构造器必须保证它所在类中所有属性都必须初始化完成，才能调用直接父类的构造器
* 指定构造器必须为继承而来的属性设置新值之前调用其直接父类的构造器
* 便利构造器必须为任意属性赋值新值之前调用同类中的其他构造器

10、构造器的继承与重写

* 在子类中，要重写父类的指定构造器时，必须在定义子类构造器时添加override修饰符，即使重写的是系统自动提供的默认构造器，也需要添加该修饰符，即使是在子类中实现便利构造器，重写的是父类的指定构造器
* 如果在子类中实现一个和父类便利构造器相匹配的子类构造器时，因为子类不能直接调用父类的变量构造器，所以在子类的实现中不需要添加override修饰符
* 默认情况下，子类不会继承父类的构造器，但是在如下特定情况中父类的构造器是可以被子类自动继承的。
    * 规则1：如果子类中没有定义任何指定构造器，它会自动继承父类所有的指定构造器
    * 规则2：如果子类中提供了所有父类指定构造器的实现，不管是通过规则1继承的还是自定义的实现，它都将自动继承父类所有的便利构造器，对于规则2，子类可以将父类的指定构造器实现为便利构造器

11、可失败构造器

* 如果一个类、结构体、枚举的对象，在构造的过程中有可能失败，则为其定义一个可失败构造器
* 可以添加一个或多个可失败构造器

```swift
init?
```

* 可失败构造器的参数名和参数类型不能与其他非可失败构造器的参数名、参数类型相同
* 该构造器会创建一个自身类型的可选类型的对象，通过return nil 来表明可失败构造器在何种情况下表示失败
* 可失败构造器也可以调用其他的非可失败构造器
* 可以在子类中重写父类的可失败构造器，或者在子类中的非可失败构造器重写父类的可失败构造器
* 当使用子类的非可失败构造器重写父类的可失败构造器时，向上调用父类的可失败构造器的唯一方式是对父类的可失败构造器的返回值做强制解包

```swift
init!
```

* 该可失败构造器会构建一个对应类型的隐式解包可选类型的对象
* 可以在init?中调用init!,或者init!中调用init?,或者重写也可以，或者init调用init!

12、必要构造器

* 表示该类的所有子类都必须实现该构造器
* 子类重写父类的必要构造器时，必须在子类的构造器前添加required修饰符，表示该构造器要求也应用与集成链后面的子类，此时不需要添加override
* 如果子类继承的构造器能满足必要构造器的要求，则无需在子类中显式提供必要构造器的实现

```swift
class SomeClass {
    required init() {
        //构造器的实现代码
    }
}

class SomeSubClass: SomeClass {
    required init() {
        //构造器的实现代码
    }
}
```




